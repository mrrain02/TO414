---
title: "Group Project #2"
author: "R-Hinos"
date: "2023-11-05"
output: 
  html_document: 
    highlight: tango
    theme: united
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Dataset

We chose the NBA Shooting Data from the 2014-2015 Season that gives information on all attempted shots from the season. The dataset has information regarding the game, the player that made the shot, who they were being guarded by, where they took the shot, how much time was left, and much more. The overall goal is to create an accurate model of whether a shot will be made depending on these factors. This can have significant implications, especially in the realm of sports betting, but also for the teams to better understand trends for their team and the opponents they are playing against. It can also have implications for player contract negotiations and creating a well balanced team of players. Below, you will find the early stages of our discovery of this dataset and a simple logistical regression model. Our next step is to build out more models and also gather more data through webscraping. NBA offers a REST API we can call to get more updated information from the more recent seasons which is something we are considering.


# Load Libraries
```{r}
library(caret)
library(neuralnet)
library(caret)
library(class)
library(kernlab)
library(C50)
library(tidyr)
library(dplyr)
library(janitor)
```


# Read Data
```{r}
nba <- read.csv("shot_logs.csv", stringsAsFactors = TRUE)
str(nba)
summary(nba)
```

# Clean Data
```{r}
nba$GAME_ID <- NULL
nba$MATCHUP <- NULL

# Remove rows that have empty show clock time 
nba <- nba[complete.cases(nba$SHOT_CLOCK), ]

colSums(is.na(nba))

nba$FGM <- as.factor(nba$FGM)

str(nba)
summary(nba)
```

# Pre Process Data
# Pre-Processing Data
```{r}
# Using model.matrix to convert all the factors to dummy variables
# We are converting all of the factors into dummy variables as the input into knn has to be numeric

nbamm <- as.data.frame(model.matrix(~.-1,nba))
nbamm <- clean_names(nbamm)
str(nbamm)


#Normalize the data
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

# We are going to normalize everything for KNN and ANN
nba_norm <- as.data.frame(lapply(nbamm, normalize))

```


# Split Train and Test 
```{r}

set.seed(12345)
train_set <- sample(1:nrow(nba), 0.7*nrow(nba)) 

# Split for Logistical Regression 
nba_log_train <- nba[train_set, ]
nba_log_test <- nba[-train_set, ]

# Split for ANN
nba_ann_train <- nba_norm[train_set, ]
nba_ann_test <- nba_norm[-train_set, ]


# Split for SVM
nba_svm_train <- nbamm[train_set, ]
nba_svm_test <- nbamm[-train_set, ]

#Create a train set and test set with separate x and y cols
#First the predictors - all columns except the yyes column
nba_train <- nba_norm[train_set, -match("FGM",names(nba_norm))]
nba_test <- nba_norm[-train_set, -match("FGM",names(nba_norm))]

#Now the response (aka Labels) - only the yyes column
nba_train_labels <- nba_norm[train_set, "FGM"]
nba_test_labels <- nba_norm[-train_set, "FGM"]


```


# Logistical Regression 
```{r}

NbaModel=glm(FGM ~ DRIBBLES + TOUCH_TIME + SHOT_DIST + CLOSE_DEF_DIST + SHOT_CLOCK,data=nba_log_train,family="binomial")

# Use the logistic regression model 'NbaModel' to generate predictions on the test dataset

testpred1 <- predict(NbaModel, nba_log_test, type = "response")
# Convert the predicted probabilities into binary outcomes: 1 if probability >= 0.38, otherwise 0
binpred1 <- ifelse(testpred1 >= .38, 1, 0)
# Generate a confusion matrix to evaluate the performance of t-he predictions against the actual test labels


confusionMatrix(as.factor(binpred1), as.factor(nba_log_test$FGM), positive = "1")

```

# ANN Model
```{r}
ann_model <- neuralnet(FGM ~., data=nba_ann_train, hidden = 3)

# (Comment) Save the model to a file
saveRDS(ann_model, "ann_model_3.rds")

# Load the model
ann_model <- readRDS("ann_model_3.rds")

ann_prediction <- predict(ann_model, nba_ann_test)

# Display a summary of the ANN model's predictions
summary(ann_prediction)

# Convert the predicted probabilities from the ANN model into binary outcomes: 1 if probability > 0.35, otherwise 0
binary_ann <- ifelse(ann_prediction > .35, 1, 0)

# Generate a confusion matrix to evaluate the performance of the binary predictions against the actual test labels
confusionMatrix(as.factor(binary_ann), as.factor(nba_test_labels), positive = "1")

```

